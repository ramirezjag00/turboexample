# TurboModuleExample
> RN CLI App with local turbo module

> ðŸ“– **Official Guide**: [Native Modules](https://reactnative.dev/docs/turbo-native-modules-introduction)

> Prefer reading code? Skip this README and check out [the code changes](https://github.com/ramirezjag00/turboexample/pull/1)

A React Native project demonstrating the in-app integration of [Turbo Modules](https://reactnative.dev/docs/turbo-native-modules-introduction) with both iOS and Android platforms. This project shows how to create *localStorage* using Android **SharedPreferences (Kotlin)** and **NSUserDefaults (Objective-C)**, and showcases a structure.

## ðŸ“¹ Demo

<img src="./assets/localstorage.gif" width="500" />

## ðŸ“ Project Structure

```
TurboModuleExample/
â”œâ”€â”€ ðŸ“± App.tsx                                    # Main React Native app demonstrating localStorage usage
â”œâ”€â”€ ðŸ“¦ package.json                               # where codegen configuration lives
â”œâ”€â”€ ðŸ“ specs/                                     # TypeScript Turbo Module specifications directory
â”‚   â””â”€â”€ NativeLocalStorage.ts                     # ðŸ”§ Turbo Module interface for localStorage operations (spec file)
â”œâ”€â”€ ðŸŽ ios/
â”‚   â””â”€â”€ NativeLocalStorage/                       # iOS Turbo Module implementation
â”‚       â”œâ”€â”€ RCTNativeLocalStorage.h               # Obj-C header file (Objective-C)
â”‚       â””â”€â”€ RCTNativeLocalStorage.mm              # implementation of generated NativeLocalStorageSpec interface using NSUserDefaults (Objective-C++)
â””â”€â”€ ðŸ¤– android/
    â””â”€â”€ app/src/main/java/
        â”œâ”€â”€ com/turbomoduleexample/                
        â”‚   â””â”€â”€ MainApplication.kt                 # app entry point with package registration
        â””â”€â”€ com/nativelocalstorage/                # our Turbo Module namespace
            â”œâ”€â”€ NativeLocalStorageModule.kt        # implementation of generated NativeLocalStorageSpec interface using SharedPreferences
            â””â”€â”€ NativeLocalStoragePackage.kt       # provides an object to register our Module in the React Native runtime, by wrapping it as a Base Native Package
```

## ðŸ› ï¸ Setup Instructions
### Prerequisites
React Native development environment

### Instructions

1. Create the spec file
> Take note of our module name "*NativeLocalStorage*".
> 
> This'll get used (prefixed or suffixed) once we write our iOS / Android files.
```ts
// in specs/NativeLocalStorage.ts
import type { TurboModule } from 'react-native';
import { TurboModuleRegistry } from 'react-native';

export interface Spec extends TurboModule {
  setItem(value: string, key: string): void;
  getItem(key: string): string | null;
  removeItem(key: string): void;
  clear(): void;
}

export default TurboModuleRegistry.getEnforcing<Spec>(
  'NativeLocalStorage',
);
```

2. Create codegen config
> `"android"` & `"ios"` keys to tell React Native about the link between the JS specs of the Native Module and the concrete implementation of those specs in native code
```json
// in package.json

"codegenConfig": {
  // name of the interface generated by codegen
  // ðŸ’¡ we'll use this later once we start implementing android / ios code
  // *Spec is the suffix
  "name": "NativeLocalStorageSpec",
  "type": "modules",
  "jsSrcsDir": "specs",
  "android": {
    // ðŸ’¡ our android namespace
    // normally, a name close to our module name
    "javaPackageName": "com.nativelocalstorage"
  },
  "ios": {
    "modulesProvider": {
      // ðŸ’¡ "RCT*" is a prefix required
      "NativeLocalStorage": "RCTNativeLocalStorage"
    }
  }
},
```
3. Run codegen
> ðŸ’¡ Unlike [Nitro Modules](https://nitro.margelo.com/docs/using-nitro-in-your-app#2-creating-nitro-specs), you won't see generated files after running these commands
```sh
# Android
cd android && ./gradlew generateCodegenArtifactsFromSchema
```

```sh
# iOS
cd ios && rm -rf Pods Podfile.lock && bundle install && bundle exec pod install && cd ..
```

4. [Write Application Code using the Turbo Native Module](https://reactnative.dev/docs/turbo-native-modules-introduction?platforms=android#3-write-application-code-using-the-turbo-native-module) (See `App.tsx`)
> You'll see that we imported our spec file (`NativeLocalStorage.ts`) into `App.tsx`.
>
> ðŸ’¡ To organize this in a larger codebase, simply create `*Module.ts` files in a new dir called `src/modules` where each spec file imports will live and be consumed.
> 
> *e.g. LocalStorageModule.ts file that exports LocalStorageModule object with functions like getItem etc.*

5. Write Native Platform Code
#### Android
> You'll be asked to create:
> - android/app/src/main/java/com/nativelocalstorage/NativeLocalStorageModule.kt
> - android/app/src/main/java/com/nativelocalstorage/NativeLocalStoragePackage.kt
>
> ðŸ’¡ If you copied from the guide, you might get some lint warnings once you open the implementation code (NativeLocalStorageModule.kt) in **Android Studio**, but there's an autofix if you highlight the yellow line and press (`option + return` keys)

See [Android - Kotlin](https://reactnative.dev/docs/turbo-native-modules-introduction?platforms=android&package-manager=yarn&android-language=kotlin#4-write-your-native-platform-code) Guide

#### iOS
> ðŸ’¡ If **XCode** prompts to create a `swift objective c bridging header` while creating Cocoa Touch Class (RCTNativeLocalStorage), ***skip it***, otherwise build is going to fail. We're not going to use Swift in this example.
> 
> Similar to android, if you get warnings when writing in the Obj-C++ file (RCTNativeLocalStorage.mm), there's a pop up if you click warnings and a fix button.

See [iOS - Obj-C](https://reactnative.dev/docs/turbo-native-modules-introduction?platforms=ios#4-write-your-native-platform-code) Guide

> At this point, you need to re-install the pods to make sure that codegen runs again to generate the new files:
```sh
# iOS
yarn pods
```

6. Run the app
```sh
yarn android
# OR
yarn ios
```